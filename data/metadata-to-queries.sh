#!/bin/bash
sed -r "s/transmission time ([0-9]{4}) ([A-Z][a-z]{2}) ([0-9]{1,2}) ([0-9]{1,2}):([0-9]{2}) data ([0-9?]{2}) ([0-9?]{3})/\n\nSELECT @timestamp:=UNIX_TIMESTAMP('\1-\2-\3 \4:\5:00');\nINSERT INTO \`broadcasts\` (StationID, Type, BroadcastStart, BroadcastEnd, ScheduleLeafID, Confirmed) VALUES (@stationId, 'data', @timestamp, @timestamp+300, NULL, True);\nSELECT @broadcastId:=LAST_INSERT_ID();\nINSERT INTO \`broadcastFrequencies\` (BroadcastID, Frequency, ModulationID) VALUES (@broadcastId, @frequency, @modulationId);\nINSERT INTO \`transmissions\` (BroadcastID, Callsign, Timestamp, ClassID) VALUES (@broadcastId, @callsign, @timestamp, @classId);\nSELECT @transmissionId:=LAST_INSERT_ID(), @order:=0;INSERT INTO \`s28-leading\` (TransmissionID, \`Order\`, Number1, Number2) VALUES (@transmissionId, @order, \"\6\", \"\7\");/;: block;s/ ([^ ]+)( ru [^ ]+)? ([0-9?]{2}) ([0-9?]{2}) ([0-9?]{2}) ([0-9?]{2})/\nSELECT @order:=@order+1;\nINSERT INTO \`s28-blocks\` (TransmissionID, \`Order\`, Codeword, Number1, Number2, Number3, Number4) VALUES (@transmissionId, @order, \"\1\", \"\3\", \"\4\", \"\5\", \"\6\"); -- \2/;s/--\s+ru ([^ ]+)/\nSELECT @blockId:=LAST_INSERT_ID();\nINSERT INTO \`foreignSupplement\` (LocalID, FieldName, ForeignText, LangCode) VALUES (@blockId, 's28-blocks.Codeword', \"\1\", 'ru');/;t block" | sed "s/-Jan-/-01-/;s/-Feb-/-02-/;s/-Mar-/-03-/;s/-Apr-/-04-/;s/-May-/-05-/;s/-Jun-/-06-/;s/-Jul-/-07-/;s/-Aug-/-08-/;s/-Sep-/-09-/;s/-Oct-/-10-/;s/-Nov-/-11-/;s/-Dec-/-12-/;" | cat query-header.sql - query-footer.sql
